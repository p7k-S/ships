cmake_minimum_required(VERSION 3.10)
project(GameProject)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Компиляторы для кросс-компиляции под Windows
set(CMAKE_C_COMPILER x86_64-w64-mingw32-gcc)
set(CMAKE_CXX_COMPILER x86_64-w64-mingw32-g++)

# Принудительно указываем расширение .exe
set(CMAKE_EXECUTABLE_SUFFIX ".exe")

# Путь к SFML для Windows (статическая версия)
set(SFML_DIR "${CMAKE_SOURCE_DIR}/SFML-2.5.1")

# Автоматическая конвертация ресурсов в один файл
add_custom_command(
    OUTPUT src/textures/embedded_resources.h

    COMMAND rm -f src/textures/embedded_resources.h

    COMMAND echo "// Embedded resources - generated automatically" > src/textures/embedded_resources.h
    COMMAND echo "#pragma once" >> src/textures/embedded_resources.h
    COMMAND echo "" >> src/textures/embedded_resources.h
    COMMAND xxd -i src/textures/player_ship.png | sed 's/src_textures_//g' >> src/textures/embedded_resources.h
    COMMAND echo "" >> src/textures/embedded_resources.h
    COMMAND xxd -i src/textures/pirates_ship.png | sed 's/src_textures_//g' >> src/textures/embedded_resources.h
    COMMAND echo "" >> src/textures/embedded_resources.h
    COMMAND xxd -i src/textures/enemy_ship.png | sed 's/src_textures_//g' >> src/textures/embedded_resources.h
    COMMAND echo "" >> src/textures/embedded_resources.h
    COMMAND xxd -i src/textures/gold_cons.png | sed 's/src_textures_//g' >> src/textures/embedded_resources.h
    COMMAND echo "" >> src/textures/embedded_resources.h
    COMMAND xxd -i src/textures/treasure.png | sed 's/src_textures_//g' >> src/textures/embedded_resources.h
    COMMAND echo "" >> src/textures/embedded_resources.h
    COMMAND xxd -i src/textures/JetBrainsMonoNLNerdFont-Regular.ttf | sed 's/src_textures_//g' >> src/textures/embedded_resources.h
    DEPENDS 
        src/textures/player_ship.png
        src/textures/pirates_ship.png
        src/textures/enemy_ship.png
        src/textures/gold_cons.png
        src/textures/treasure.png
        src/textures/JetBrainsMonoNLNerdFont-Regular.ttf
    OUTPUT src/textures/UIfont.h
    COMMAND rm -f src/textures/UIfont.h
    COMMAND xxd -i src/textures/airborne.ttf | sed 's/src_textures_//g' >> src/textures/UIfont.h
    DEPENDS 
        src/textures/airborne.ttf
    WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
    COMMENT "Creating embedded_resources.h with all resources"

)

add_custom_target(embedded_resources ALL DEPENDS src/textures/embedded_resources.h)

include_directories(
    ${CMAKE_SOURCE_DIR}/src/game
    ${CMAKE_SOURCE_DIR}/src/render
    ${CMAKE_SOURCE_DIR}/src/render/map
    ${CMAKE_SOURCE_DIR}/src/textures
    ${CMAKE_SOURCE_DIR}/src/net
    ${SFML_DIR}/include
)

set(SOURCE_FILES
    src/main.cpp
    src/game/map/GenerateMap.cpp
    src/game/map/MapFuncs.cpp
    src/game/troops/BaseTroop.cpp
    src/game/entity/EntityFuncs.cpp
    src/game/GameConfig.cpp
    src/game/Game.cpp
    src/game/GameInit.cpp
    src/game/GameRender.cpp
    src/game/GameEvents.cpp 
    src/game/GameLogic.cpp
    src/game/GameMap.cpp 
    src/game/GameUtils.cpp
    src/render/ui/UIRenderer.cpp
    src/textures/EmbeddedResources.cpp
    src/net/P2PNode.cpp
)

add_executable(GameProject ${SOURCE_FILES})
add_dependencies(GameProject embedded_resources)

# Флаг для статической линковки SFML
target_compile_definitions(GameProject PRIVATE SFML_STATIC)

# Линковка СТАТИЧЕСКИХ библиотек SFML для Windows
target_link_directories(GameProject PRIVATE ${SFML_DIR}/lib)
target_link_libraries(GameProject PRIVATE 
    sfml-graphics-s
    sfml-window-s
    sfml-system-s
    sfml-network-s
)

# Системные библиотеки Windows (ДОБАВЛЕНЫ сетевые библиотеки)
target_link_libraries(GameProject PRIVATE 
    opengl32
    winmm
    gdi32
    freetype
    ws2_32  # ← Winsock2 для сетевых функций
    iphlpapi # ← Дополнительные сетевые функции
    wsock32  # ← Старый Winsock для совместимости
)

# Полная статическая линковка (все в одном EXE)
target_link_options(GameProject PRIVATE 
    -static
    -static-libgcc
    -static-libstdc++
)
